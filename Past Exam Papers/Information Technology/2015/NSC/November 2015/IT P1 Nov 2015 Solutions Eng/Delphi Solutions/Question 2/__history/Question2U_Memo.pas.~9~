unit Question2U_Memo;

// Solution for question 2.2

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, Buttons, ComCtrls, ExtCtrls, TraineeU;

type
  TfrmQuestionTWO = class(TForm)
    bmbClose: TBitBtn;
    lblFormHeading: TLabel;
    redQ2: TRichEdit;
    pnlButtons: TPanel;
    btnQuestion222: TButton;
    btnQuestion221: TButton;
    pnlQ223: TPanel;
    btnQuestion223: TButton;
    Label1: TLabel;
    edtTotalSessions: TEdit;
    btnQuestion224: TButton;
    pnlProgress: TPanel;
    lblProgress: TLabel;
    lblCompleted: TLabel;
    chkCompleted: TCheckBox;
    lblTrainingDate: TLabel;
    edtTrainingDate: TEdit;
    lblTrainee: TLabel;
    lblDate: TLabel;
    lblRegCode: TLabel;
    edtTrainee: TEdit;
    edtRegCode: TEdit;
    edtDate: TEdit;
    procedure FormCreate(Sender: TObject);
    procedure btnQuestion221Click(Sender: TObject);
    procedure btnQuestion222Click(Sender: TObject);
    procedure btnQuestion223Click(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    procedure btnQuestion224Click(Sender: TObject);

  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmQuestionTWO: TfrmQuestionTWO;

implementation

var
  objTrainee: TTrainee;
{$R *.dfm}
{$R+}

  // ==================================================================
  // Question 2.2.1
procedure TfrmQuestionTWO.btnQuestion221Click(Sender: TObject);

begin
  objTrainee := TTrainee.Create(edtTrainee.text, edtRegCode.text, edtdate.text);

  redQ2.Lines.Clear;
  redQ2.Lines.Add(objTrainee.toString);
end;

// ==================================================================
// Question 2.2.2
procedure TfrmQuestionTWO.btnQuestion222Click(Sender: TObject);
var
  TxtFile: Textfile;
  sLine, sRegCode, sDate: string;
  iCount: integer;
begin

  if not FileExists('DataQ2.txt') then
  begin
    MessageDlg('File does not exists.', mtError, [mbOk], 0);
    Exit;
  end;

  AssignFile(TxtFile, 'DataQ2.txt');
  Reset(TxtFile);

  iCount := 0;
  redQ2.Clear;
  redQ2.Lines.Add('Name of trainee ' + objTrainee.GetName);
  redQ2.Lines.Add('Dates of completed sessions:');
  While NOT EOF(TxtFile) do
  begin
    readln(TxtFile, sLine);
    if pos(objTrainee.GetCode, sLine) = 1 then
    begin
      Delete(sLine, 1, pos('on ', sLine) + 2);
      sDate := copy(sLine, 1, pos('#', sLine) - 1);
      Delete(sLine, 1, pos('#', sLine));
      if sLine = 'Completed' then
      begin
        redQ2.Lines.Add(sDate);
        inc(iCount, 1);
      end;
    end;
  end; // while
  objTrainee.setSessionsCompleted(iCount);
  CloseFile(TxtFile);

  redQ2.Lines.Add(#10);
  redQ2.Lines.Add(objTrainee.toString);

  btnQuestion223.Enabled := true;
  btnQuestion224.Enabled := true;
end;

// ==================================================================
// Question 2.2.3
procedure TfrmQuestionTWO.btnQuestion223Click(Sender: TObject);
var
  TxtFile: Textfile;
  sLine, sCompleted, sSesDate: string;
begin
  sSesDate := edtTrainingDate.text;
  if objTrainee.hasExpired(sSesDate) = true then
    ShowMessage('Qualification time has expired.' + #13 +
        'Record cannot be added to the file.')
  else
  begin
    if chkCompleted.Checked = false then
      sCompleted := 'Not Completed'
    else
    begin
      sCompleted := 'Completed';
      objTrainee.increaseSessionsCompleted;
    end;

    sLine := objTrainee.getCode + ' trained on ' + sSesDate + '#' + sCompleted;

    AssignFile(TxtFile, 'DataQ2.txt');
    Append(TxtFile);
    writeln(TxtFile, sLine);
    CloseFile(TxtFile);

    ShowMessage('Information was successfully written to the file');
  end;

  redQ2.Lines.Clear;
  redQ2.Lines.Add(objTrainee.toString);
end;
// ==================================================================
// Question 2.2.4

procedure TfrmQuestionTWO.btnQuestion224Click(Sender: TObject);
var
  iSessions: integer;
  sProgress: string;
begin
  iSessions := StrToInt(edtTotalSessions.text);
  sProgress := objTrainee.evaluateProgress(iSessions);
  lblProgress.Caption := sProgress;
end;

// ==================================================================
// Supplied code
procedure TfrmQuestionTWO.FormCreate(Sender: TObject);
begin
  CurrencyString := 'R';
  ShortDateFormat := 'YYYY/MM/DD';
  edtTrainingDate.text := DateToStr(Now());
  btnQuestion223.Enabled := false;
  btnQuestion224.Enabled := false;
end;

procedure TfrmQuestionTWO.FormDestroy(Sender: TObject);
begin
  objTrainee.Free;
end;


// ==================================================================

end.
